#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
×‘×•×˜ ××™×“×¢ ×›×œ×œ×™ ×¢×œ ×ª×¨×•×¤×•×ª - ××˜× ×˜, ×¤×¨×§×•×¡×˜, ×¨×™×˜×œ×™×Ÿ
×œ×œ× ×™×™×¢×•×¥ ×¨×¤×•××™ - ×¨×§ ××™×“×¢ ×›×œ×œ×™ ×•×”×¤× ×™×” ×œ×¨×•×¤×
"""

import logging
from telegram import Update
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes
import json
import datetime
import os

# ×”×’×“×¨×ª ×”×œ×•×’×™×
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# ×˜×•×§×Ÿ ×”×‘×•×˜
BOT_TOKEN = "8121925236:AAE34qOjqMNqtlEqsgZnqvIARL1tyyPNkX0"

# ×§×•×‘×¥ × ×ª×•× ×™×
DATA_FILE = "medications_bot_data.json"

def load_data():
    """×˜×¢×™× ×ª × ×ª×•× ×™× ××”×§×•×‘×¥"""
    try:
        if os.path.exists(DATA_FILE):
            with open(DATA_FILE, 'r', encoding='utf-8') as f:
                return json.load(f)
    except Exception as e:
        logger.error(f"×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×: {e}")
    return {"users": [], "messages": []}

def save_data(data):
    """×©××™×¨×ª × ×ª×•× ×™× ×œ×§×•×‘×¥"""
    try:
        with open(DATA_FILE, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)
    except Exception as e:
        logger.error(f"×©×’×™××” ×‘×©××™×¨×ª × ×ª×•× ×™×: {e}")

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """×¤×•× ×§×¦×™×™×ª ×”×ª×—×œ×”"""
    user = update.effective_user
    chat_id = update.effective_chat.id
    
    # ×©××™×¨×ª ×”××©×ª××©
    data = load_data()
    if chat_id not in data["users"]:
        data["users"].append(chat_id)
        save_data(data)
    
    welcome_message = """ğŸ’Š ×‘×¨×•×›×™× ×”×‘××™× ×œ××™×“×¢ ×›×œ×œ×™ ×¢×œ ×ª×¨×•×¤×•×ª

ğŸ“‹ ××™×“×¢ ×›×œ×œ×™ ×–××™×Ÿ ×¢×œ:
â€¢ **××˜× ×˜** 
â€¢ **×¤×¨×§×•×¡×˜**
â€¢ **×¨×™×˜×œ×™×Ÿ**

âš ï¸ **×”×¢×¨×” ×—×©×•×‘×”:**
×”××™×“×¢ ×›××Ÿ ×”×•× ×›×œ×œ×™ ×‘×œ×‘×“ ×•×œ× ××—×œ×™×£ ×™×™×¢×•×¥ ×¨×¤×•××™ ××§×¦×•×¢×™.
×ª××™×“ ×”×™×•×•×¢×¦×• ×¢× ×¨×•×¤× ××• ×¨×•×§×— ×œ×¤× ×™ × ×˜×™×œ×ª ×ª×¨×•×¤×•×ª.

ğŸ’¬ ×©×œ×—×• ×©× ×ª×¨×•×¤×” ×œ×§×‘×œ×ª ××™×“×¢ ×›×œ×œ×™"""
    
    await update.message.reply_text(welcome_message)
    
    # ×œ×•×’ ×”××©×ª××©
    logger.info(f"××©×ª××© ×—×“×© ×”×ª×—×™×œ: {user.first_name} ({chat_id})")

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """×˜×™×¤×•×œ ×‘×”×•×“×¢×•×ª"""
    user = update.effective_user
    chat_id = update.effective_chat.id
    message_text = update.message.text.lower()
    
    # ×©××™×¨×ª ×”×”×•×“×¢×”
    data = load_data()
    data["messages"].append({
        "user_id": chat_id,
        "message": update.message.text,
        "timestamp": datetime.datetime.now().isoformat()
    })
    save_data(data)
    
    # ××¢× ×” ×œ×¤×™ ×ª×•×›×Ÿ ×”×”×•×“×¢×”
    if any(keyword in message_text for keyword in ["××˜× ×˜", "etnet"]):
        response = """ğŸ’Š **××˜× ×˜ - ××™×“×¢ ×›×œ×œ×™**

ğŸ“‹ **××™×“×¢ ×‘×¡×™×¡×™:**
××˜× ×˜ ×”×•× ×©× ××¡×—×¨×™ ×œ×ª×¨×•×¤×” ×”××›×™×œ×” ×—×•××¨ ×¤×¢×™×œ ××¡×•×™×.

âš ï¸ **×”×¢×¨×•×ª ×—×©×•×‘×•×ª:**
â€¢ ×”×ª×¨×•×¤×” ×“×•×¨×©×ª ××¨×©× ×¨×•×¤×
â€¢ ×™×© ×œ×§×¨×•× ××ª ×¢×œ×•×Ÿ ×”×ª×¨×•×¤×” ×‘×§×¤×™×“×”
â€¢ ×™×© ×œ×”×§×¤×™×“ ×¢×œ ×”××™× ×•×Ÿ ×©× ×§×‘×¢ ×¢×œ ×™×“×™ ×”×¨×•×¤×
â€¢ ×™×© ×œ×“×•×•×— ×œ×¨×•×¤× ×¢×œ ×ª×•×¤×¢×•×ª ×œ×•×•××™

ğŸ‘¨â€âš•ï¸ **×œ×§×‘×œ×ª ××™×“×¢ ××§×¦×•×¢×™:**
â€¢ ×”×™×•×•×¢×¦×• ×¢× ×”×¨×•×¤× ×”××˜×¤×œ
â€¢ ×¤× ×• ×œ×¨×•×§×— ×œ×©××œ×•×ª ×¢×œ ×”×©×™××•×©
â€¢ ×§×¨××• ××ª ×”×¢×œ×•×Ÿ ×”××¦×•×¨×£ ×œ×ª×¨×•×¤×”

ğŸ“ **×‘××§×¨×” ×—×™×¨×•× ××• ×ª×•×¤×¢×•×ª ×—××•×¨×•×ª - ×¤× ×• ××™×“ ×œ×¨×•×¤× ××• ×œ×—×“×¨ ××™×•×Ÿ**"""
        
    elif any(keyword in message_text for keyword in ["×¤×¨×§×•×¡×˜", "perkaust"]):
        response = """ğŸ’Š **×¤×¨×§×•×¡×˜ - ××™×“×¢ ×›×œ×œ×™**

ğŸ“‹ **××™×“×¢ ×‘×¡×™×¡×™:**
×¤×¨×§×•×¡×˜ ×”×•× ×©× ××¡×—×¨×™ ×œ×ª×¨×•×¤×” ×”××›×™×œ×” ×—×•××¨ ×¤×¢×™×œ ××¡×•×™×.

âš ï¸ **×”×¢×¨×•×ª ×—×©×•×‘×•×ª:**
â€¢ ×”×ª×¨×•×¤×” ×“×•×¨×©×ª ××¨×©× ×¨×•×¤×
â€¢ ×™×© ×œ×§×¨×•× ××ª ×¢×œ×•×Ÿ ×”×ª×¨×•×¤×” ×‘×§×¤×™×“×”
â€¢ ×™×© ×œ×”×§×¤×™×“ ×¢×œ ×”××™× ×•×Ÿ ×©× ×§×‘×¢ ×¢×œ ×™×“×™ ×”×¨×•×¤×
â€¢ ×™×© ×œ×“×•×•×— ×œ×¨×•×¤× ×¢×œ ×ª×•×¤×¢×•×ª ×œ×•×•××™

ğŸ‘¨â€âš•ï¸ **×œ×§×‘×œ×ª ××™×“×¢ ××§×¦×•×¢×™:**
â€¢ ×”×™×•×•×¢×¦×• ×¢× ×”×¨×•×¤× ×”××˜×¤×œ
â€¢ ×¤× ×• ×œ×¨×•×§×— ×œ×©××œ×•×ª ×¢×œ ×”×©×™××•×©
â€¢ ×§×¨××• ××ª ×”×¢×œ×•×Ÿ ×”××¦×•×¨×£ ×œ×ª×¨×•×¤×”

ğŸ“ **×‘××§×¨×” ×—×™×¨×•× ××• ×ª×•×¤×¢×•×ª ×—××•×¨×•×ª - ×¤× ×• ××™×“ ×œ×¨×•×¤× ××• ×œ×—×“×¨ ××™×•×Ÿ**"""
        
    elif any(keyword in message_text for keyword in ["×¨×™×˜×œ×™×Ÿ", "ritalin"]):
        response = """ğŸ’Š **×¨×™×˜×œ×™×Ÿ - ××™×“×¢ ×›×œ×œ×™**

ğŸ“‹ **××™×“×¢ ×‘×¡×™×¡×™:**
×¨×™×˜×œ×™×Ÿ ×”×•× ×©× ××¡×—×¨×™ ×œ×ª×¨×•×¤×” ×”××›×™×œ×” ×—×•××¨ ×¤×¢×™×œ ××ª×™×œ×¤× ×™×“×˜.
×”×ª×¨×•×¤×” ××©××©×ª ×œ×˜×™×¤×•×œ ×‘×”×¤×¨×¢×•×ª ×§×©×‘ ×•×¨×™×›×•×– (ADHD).

âš ï¸ **×”×¢×¨×•×ª ×—×©×•×‘×•×ª:**
â€¢ ×”×ª×¨×•×¤×” ×“×•×¨×©×ª ××¨×©× ×¨×•×¤× ×•×”×“×•×§
â€¢ ×™×© ×œ×§×¨×•× ××ª ×¢×œ×•×Ÿ ×”×ª×¨×•×¤×” ×‘×§×¤×™×“×”
â€¢ ×™×© ×œ×”×§×¤×™×“ ×¢×œ ×”××™× ×•×Ÿ ×©× ×§×‘×¢ ×¢×œ ×™×“×™ ×”×¨×•×¤×
â€¢ ×™×© ×œ×“×•×•×— ×œ×¨×•×¤× ×¢×œ ×ª×•×¤×¢×•×ª ×œ×•×•××™
â€¢ ×”×ª×¨×•×¤×” ×“×•×¨×©×ª ××¢×§×‘ ×¨×¤×•××™ ×©×•×˜×£

ğŸ‘¨â€âš•ï¸ **×œ×§×‘×œ×ª ××™×“×¢ ××§×¦×•×¢×™:**
â€¢ ×”×™×•×•×¢×¦×• ×¢× ×”×¨×•×¤× ×”××˜×¤×œ
â€¢ ×¤× ×• ×œ×¨×•×§×— ×œ×©××œ×•×ª ×¢×œ ×”×©×™××•×©
â€¢ ×§×¨××• ××ª ×”×¢×œ×•×Ÿ ×”××¦×•×¨×£ ×œ×ª×¨×•×¤×”

ğŸ“ **×‘××§×¨×” ×—×™×¨×•× ××• ×ª×•×¤×¢×•×ª ×—××•×¨×•×ª - ×¤× ×• ××™×“ ×œ×¨×•×¤× ××• ×œ×—×“×¨ ××™×•×Ÿ**"""
        
    elif any(keyword in message_text for keyword in ["×ª×•×¤×¢×•×ª", "×œ×•×•××™", "side effects"]):
        response = """âš ï¸ **×ª×•×¤×¢×•×ª ×œ×•×•××™ - ××™×“×¢ ×›×œ×œ×™**

ğŸ“‹ **×¢×§×¨×•× ×•×ª ×—×©×•×‘×™×:**
â€¢ ×›×œ ×ª×¨×•×¤×” ×¢×œ×•×œ×” ×œ×’×¨×•× ×œ×ª×•×¤×¢×•×ª ×œ×•×•××™
â€¢ ×”×ª×•×¤×¢×•×ª ××©×ª× ×•×ª ×‘×™×Ÿ ×× ×©×™×
â€¢ ×™×© ×œ×§×¨×•× ××ª ×¢×œ×•×Ÿ ×”×ª×¨×•×¤×” ×œ×¤×™×¨×•×˜ ××œ×

ğŸš¨ **××ª×™ ×œ×¤× ×•×ª ×œ×¨×•×¤×:**
â€¢ ×ª×•×¤×¢×•×ª ×—××•×¨×•×ª ××• ××˜×¨×™×“×•×ª
â€¢ ×ª×•×¤×¢×•×ª ×©×œ× ××•×–×›×¨×•×ª ×‘×¢×œ×•×Ÿ
â€¢ ×”×—××¨×” ×©×œ ×ª×•×¤×¢×•×ª ×§×™×™××•×ª
â€¢ ×—×©×“ ×œ××œ×¨×’×™×” ×œ×ª×¨×•×¤×”

ğŸ‘¨â€âš•ï¸ **×—×©×•×‘ ×œ×–×›×•×¨:**
â€¢ ××œ ×ª×¤×¡×™×§×• ×ª×¨×•×¤×” ×‘×œ×™ ×”×™×•×•×¢×¦×•×ª ×¢× ×¨×•×¤×
â€¢ ×“×•×•×—×• ×œ×¨×•×¤× ×¢×œ ×›×œ ×ª×•×¤×¢×” ×—×“×©×”
â€¢ ×©××¨×• ×¨×©×™××” ×©×œ ×”×ª×•×¤×¢×•×ª ×©×—×•×•×™×

ğŸ“ **×‘××§×¨×” ×—×™×¨×•× - ×¤× ×• ××™×“ ×œ×—×“×¨ ××™×•×Ÿ**"""
        
    elif any(keyword in message_text for keyword in ["××™× ×•×Ÿ", "dosage", "×›××”", "××ª×™"]):
        response = """ğŸ’Š **××™×“×¢ ×¢×œ ××™× ×•×Ÿ**

âš ï¸ **×¢×§×¨×•×Ÿ ×™×¡×•×“:**
×”××™× ×•×Ÿ × ×§×‘×¢ ××š ×•×¨×§ ×¢×œ ×™×“×™ ×”×¨×•×¤× ×”××˜×¤×œ!

ğŸ“‹ **×›×œ×œ×™× ×—×©×•×‘×™×:**
â€¢ ××œ ×ª×©× ×• ××™× ×•×Ÿ ×œ×œ× ×”×™×•×•×¢×¦×•×ª ×¢× ×¨×•×¤×
â€¢ ××œ ×ª×§×—×• ×ª×¨×•×¤×” ×©×œ ××™×©×”×• ××—×¨
â€¢ ×”×§×¤×™×“×• ×¢×œ ×–×× ×™ ×”× ×˜×™×œ×” ×©× ×§×‘×¢×•
â€¢ ××œ ×ª×›×¤×™×œ×• ××™× ×•×Ÿ ×× ×©×›×—×ª×

ğŸ‘¨â€âš•ï¸ **×œ×©××œ×•×ª ×¢×œ ××™× ×•×Ÿ:**
â€¢ ×¤× ×• ×œ×¨×•×¤× ×”××˜×¤×œ
â€¢ ×”×ª×™×™×¢×¦×• ×¢× ×¨×•×§×—
â€¢ ×§×¨××• ××ª ×¢×œ×•×Ÿ ×”×ª×¨×•×¤×”

ğŸ“ **×—×™×¨×•× ××• ×—×©×“ ×œ×× ×ª ×™×ª×¨ - ×¤× ×• ××™×“ ×œ×—×“×¨ ××™×•×Ÿ**"""
        
    else:
        response = """ğŸ’Š **××™×“×¢ ×›×œ×œ×™ ×¢×œ ×ª×¨×•×¤×•×ª**

ğŸ“‹ **×ª×¨×•×¤×•×ª ×–××™× ×•×ª ×‘××¢×¨×›×ª:**
â€¢ ××˜× ×˜
â€¢ ×¤×¨×§×•×¡×˜  
â€¢ ×¨×™×˜×œ×™×Ÿ

âš ï¸ **×”×¢×¨×” ×—×©×•×‘×”:**
×”××™×“×¢ ×›××Ÿ ×”×•× ×›×œ×œ×™ ×‘×œ×‘×“ ×•×œ× ××—×œ×™×£ ×™×™×¢×•×¥ ×¨×¤×•××™ ××§×¦×•×¢×™.

ğŸ’¬ **××™×š ×œ×§×‘×œ ××™×“×¢:**
×©×œ×—×• ×©× ×”×ª×¨×•×¤×” ×œ×§×‘×œ×ª ××™×“×¢ ×›×œ×œ×™

ğŸ‘¨â€âš•ï¸ **×œ×™×™×¢×•×¥ ××§×¦×•×¢×™:**
â€¢ ×”×™×•×•×¢×¦×• ×¢× ×¨×•×¤×
â€¢ ×¤× ×• ×œ×¨×•×§×—
â€¢ ×§×¨××• ×¢×œ×•× ×™ ×ª×¨×•×¤×•×ª

ğŸ“ **×‘××§×¨×” ×—×™×¨×•× - ××™×“ ×œ×—×“×¨ ××™×•×Ÿ ××• ××“"× 101**"""
    
    await update.message.reply_text(response)
    
    # ×œ×•×’ ×”×”×•×“×¢×”
    logger.info(f"×”×•×“×¢×” ×-{user.first_name}: {update.message.text}")

async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """×¤×•× ×§×¦×™×™×ª ×¢×–×¨×”"""
    help_text = """ğŸ†˜ **×¢×–×¨×”**

ğŸ’Š **××™×“×¢ ×–××™×Ÿ ×¢×œ:**
â€¢ ××˜× ×˜
â€¢ ×¤×¨×§×•×¡×˜
â€¢ ×¨×™×˜×œ×™×Ÿ

ğŸ“ **××™×š ×–×” ×¢×•×‘×“:**
×©×œ×—×• ×©× ×ª×¨×•×¤×” ×•×§×‘×œ×• ××™×“×¢ ×›×œ×œ×™

âš ï¸ **×–×›×¨×•:**
×”××™×“×¢ ×›××Ÿ ×›×œ×œ×™ ×‘×œ×‘×“ - ×ª××™×“ ×”×™×•×•×¢×¦×• ×¢× ×¨×•×¤×!

ğŸ“ **×—×™×¨×•× ×¨×¤×•××™: ××“"× 101**"""
    
    await update.message.reply_text(help_text)

async def error_handler(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """×˜×™×¤×•×œ ×‘×©×’×™××•×ª"""
    logger.error(f"×©×’×™××”: {context.error}")

def main() -> None:
    """×”×¤×¢×œ×ª ×”×‘×•×˜"""
    print("ğŸš€ ××ª×—×™×œ ×‘×•×˜ ××™×“×¢ ×¢×œ ×ª×¨×•×¤×•×ª...")
    
    # ×™×¦×™×¨×ª ×”××¤×œ×™×§×¦×™×”
    application = Application.builder().token(BOT_TOKEN).build()
    
    # ×”×•×¡×¤×ª handlers
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("help", help_command))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    
    # ×”×•×¡×¤×ª error handler
    application.add_error_handler(error_handler)
    
    # ×”×¤×¢×œ×ª ×”×‘×•×˜
    print("âœ… ×‘×•×˜ ×ª×¨×•×¤×•×ª ×¤×•×¢×œ ×•××—×›×” ×œ×©××œ×•×ª...")
    print("ğŸ’Š ××™×“×¢ ×–××™×Ÿ ×¢×œ: ××˜× ×˜, ×¤×¨×§×•×¡×˜, ×¨×™×˜×œ×™×Ÿ")
    print("âš ï¸ ××™×“×¢ ×›×œ×œ×™ ×‘×œ×‘×“ - ×œ× ×™×™×¢×•×¥ ×¨×¤×•××™")
    
    application.run_polling(allowed_updates=Update.ALL_TYPES)

if __name__ == '__main__':
    main()